<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üá≤üáΩ Tamagotchi Mexicano AEMX</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #060b14;
    --panel: #0b1626;
    --panel2: #0f1e35;
    --border: #1a3a5c;
    --glow: #00c8ff;
    --glow2: #00ff9d;
    --gold: #ffd700;
    --text: #cce4ff;
    --text2: #6b8ab0;
    --warning: #ef4444;
    --success: #4ade80;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Rajdhani', sans-serif;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow-x: hidden;
  }

  /* Animated grid background */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(0,200,255,0.04) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,200,255,0.04) 1px, transparent 1px);
    background-size: 40px 40px;
    z-index: 0;
    animation: gridMove 20s linear infinite;
  }

  @keyframes gridMove {
    0% { transform: translateY(0); }
    100% { transform: translateY(40px); }
  }

  body::after {
    content: '';
    position: fixed;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(ellipse at 30% 20%, rgba(0,200,255,0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 80%, rgba(0,255,157,0.04) 0%, transparent 50%);
    z-index: 0;
    pointer-events: none;
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 500px;
    width: 95%;
    padding: 20px;
  }

  /* Card principal */
  .card {
    background: var(--panel);
    border: 3px solid var(--border);
    border-radius: 14px;
    padding: 20px;
    position: relative;
    overflow: hidden;
  }

  .card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 4px;
    background: linear-gradient(90deg, #00c8ff, #4ade80, #facc15, #c084fc, #00c8ff);
    background-size: 200% 100%;
    animation: rainbowSlide 6s linear infinite;
  }

  @keyframes rainbowSlide {
    0% { background-position: 0% 0; }
    100% { background-position: 200% 0; }
  }

  /* Header */
  .header {
    text-align: center;
    margin-bottom: 20px;
  }

  h1 {
    font-family: 'Orbitron', monospace;
    font-size: clamp(20px, 5vw, 28px);
    font-weight: 900;
    letter-spacing: 2px;
    color: var(--gold);
    margin-bottom: 5px;
  }

  .subtitle {
    font-family: 'Share Tech Mono', monospace;
    font-size: 12px;
    color: var(--text2);
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  /* Coins display */
  .coins-display {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    background: var(--panel2);
    border: 2px solid var(--gold);
    border-radius: 10px;
    padding: 10px 20px;
    margin-bottom: 20px;
    font-family: 'Share Tech Mono', monospace;
    font-size: 18px;
    font-weight: 700;
    color: var(--gold);
  }

  /* Selection screen */
  #selection-screen {
    text-align: center;
  }

  .selection-title {
    font-family: 'Orbitron', monospace;
    font-size: 18px;
    color: var(--glow);
    margin-bottom: 20px;
    letter-spacing: 1px;
  }

  .pet-options {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin-bottom: 20px;
  }

  .pet-option {
    background: var(--panel2);
    border: 3px solid var(--border);
    border-radius: 12px;
    padding: 20px 10px;
    cursor: pointer;
    transition: all 0.3s;
    text-align: center;
  }

  .pet-option:hover {
    border-color: var(--glow);
    transform: translateY(-5px);
    box-shadow: 0 0 20px rgba(0,200,255,0.3);
  }

  .pet-sprite {
    font-size: 60px;
    margin-bottom: 10px;
    display: block;
  }

  .pet-name {
    font-family: 'Rajdhani', sans-serif;
    font-weight: 600;
    font-size: 14px;
    color: var(--text);
  }

  /* Game screen */
  #game-screen {
    display: none;
  }

  /* Pet display area */
  .pet-display {
    background: var(--panel2);
    border: 2px solid var(--border);
    border-radius: 12px;
    padding: 30px;
    margin-bottom: 20px;
    text-align: center;
    min-height: 200px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  #current-pet {
    font-size: 100px;
    position: relative;
    transition: all 0.3s;
  }

  #pet-outfit {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 100px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s;
  }

  #pet-outfit.visible {
    opacity: 1;
  }

  /* Animations */
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
  }

  .hungry {
    animation: shake 0.5s infinite;
  }

  .happy {
    transform: scale(1.1);
  }

  .sad {
    filter: grayscale(100%);
    opacity: 0.7;
  }

  /* Stats */
  .stats {
    margin-bottom: 20px;
  }

  .stat {
    margin-bottom: 15px;
  }

  .stat-label {
    display: flex;
    justify-content: space-between;
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 5px;
  }

  .stat-bar-container {
    background: #060b14;
    border: 2px solid var(--border);
    border-radius: 10px;
    height: 20px;
    overflow: hidden;
    position: relative;
  }

  .stat-bar {
    height: 100%;
    transition: width 0.5s, background 0.3s;
    border-radius: 8px;
  }

  .stat-bar.happiness { background: linear-gradient(90deg, #4ade80, #00ff9d); }
  .stat-bar.hunger { background: linear-gradient(90deg, #ef4444, #fbbf24); }
  .stat-bar.sleep { background: linear-gradient(90deg, #60a5fa, #c084fc); }

  /* Buttons */
  .actions {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 20px;
  }

  .btn {
    background: var(--panel2);
    border: 2px solid var(--border);
    border-radius: 10px;
    padding: 15px 10px;
    cursor: pointer;
    font-family: 'Rajdhani', sans-serif;
    font-size: 14px;
    font-weight: 600;
    color: var(--text);
    transition: all 0.3s;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
  }

  .btn:hover {
    border-color: var(--glow);
    transform: translateY(-2px);
    box-shadow: 0 0 15px rgba(0,200,255,0.3);
  }

  .btn:active {
    transform: translateY(0);
  }

  .btn-icon {
    font-size: 24px;
  }

  .bottom-actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }

  .btn-secondary {
    background: var(--panel2);
    border: 2px solid var(--gold);
    color: var(--gold);
  }

  .btn-secondary:hover {
    border-color: var(--gold);
    box-shadow: 0 0 15px rgba(255,215,0,0.3);
  }

  /* Modal */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.8);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  .modal.active {
    display: flex;
  }

  .modal-content {
    background: var(--panel);
    border: 3px solid var(--gold);
    border-radius: 14px;
    padding: 30px;
    max-width: 400px;
    width: 100%;
    position: relative;
  }

  .modal-content::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 4px;
    background: linear-gradient(90deg, #facc15, #ffd700, #facc15);
    background-size: 200% 100%;
    animation: rainbowSlide 3s linear infinite;
  }

  .modal-title {
    font-family: 'Orbitron', monospace;
    font-size: 22px;
    color: var(--gold);
    margin-bottom: 20px;
    text-align: center;
  }

  .modal-close {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    color: var(--text);
    font-size: 24px;
    cursor: pointer;
    padding: 5px;
  }

  .shop-item {
    background: var(--panel2);
    border: 2px solid var(--border);
    border-radius: 10px;
    padding: 20px;
    text-align: center;
    margin-bottom: 15px;
  }

  .shop-item-icon {
    font-size: 60px;
    margin-bottom: 10px;
  }

  .shop-item-name {
    font-weight: 700;
    font-size: 16px;
    margin-bottom: 5px;
  }

  .shop-item-desc {
    font-size: 12px;
    color: var(--text2);
    margin-bottom: 10px;
  }

  .shop-item-price {
    color: var(--gold);
    font-weight: 700;
    margin-bottom: 15px;
  }

  .btn-buy {
    background: var(--panel);
    border: 2px solid var(--gold);
    border-radius: 8px;
    padding: 10px 20px;
    color: var(--gold);
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s;
  }

  .btn-buy:hover {
    background: var(--gold);
    color: var(--bg);
  }

  .btn-buy:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* Toast notifications */
  .toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--panel);
    border: 2px solid var(--glow);
    border-radius: 10px;
    padding: 15px 20px;
    z-index: 2000;
    font-family: 'Share Tech Mono', monospace;
    transform: translateX(400px);
    transition: transform 0.3s;
  }

  .toast.show {
    transform: translateX(0);
  }

  .toast.success { border-color: var(--success); color: var(--success); }
  .toast.warning { border-color: var(--warning); color: var(--warning); }
  .toast.gold { border-color: var(--gold); color: var(--gold); }

  /* Reset button */
  .btn-reset {
    width: 100%;
    margin-top: 20px;
    background: var(--panel2);
    border: 2px solid var(--warning);
    color: var(--warning);
  }

  .btn-reset:hover {
    border-color: var(--warning);
    box-shadow: 0 0 15px rgba(239,68,68,0.3);
  }

  /* Login screen */
  #login-screen {
    position: fixed;
    inset: 0;
    background: rgba(6, 11, 20, 0.97);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    backdrop-filter: blur(8px);
  }

  #login-screen.hidden {
    display: none;
  }

  .login-container {
    background: var(--panel);
    border: 1px solid var(--glow);
    border-radius: 16px;
    padding: 44px 40px;
    max-width: 380px;
    width: 90%;
    text-align: center;
    box-shadow: 0 0 60px rgba(0,200,255,0.12);
    animation: fadeUp 0.4s ease;
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(20px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .login-icon {
    font-size: 80px;
    margin-bottom: 20px;
  }

  .login-title {
    font-family: 'Orbitron', monospace;
    font-size: 14px;
    color: var(--glow);
    letter-spacing: 4px;
    margin-bottom: 8px;
  }

  .login-subtitle {
    font-family: 'Rajdhani', sans-serif;
    color: var(--text2);
    font-size: 13px;
    margin-bottom: 28px;
    letter-spacing: 1px;
  }

  .auth-btn-google {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    width: 100%;
    padding: 13px 20px;
    background: linear-gradient(135deg, #1a3a5c, #0b1626);
    border: 1px solid var(--glow);
    border-radius: 10px;
    color: var(--glow);
    font-family: 'Rajdhani', sans-serif;
    font-size: 14px;
    font-weight: 600;
    letter-spacing: 2px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .auth-btn-google:hover {
    background: var(--glow);
    color: #060b14;
    box-shadow: 0 0 24px rgba(0,200,255,0.4);
  }

  #google-signin-btn {
    margin: 0 auto;
  }

  .location-status {
    margin-top: 20px;
    font-size: 12px;
    color: var(--text2);
    letter-spacing: 1px;
    min-height: 18px;
  }

  .location-status.checking {
    color: var(--glow);
  }

  .location-status.success {
    color: var(--success);
  }

  .location-status.error {
    color: var(--warning);
  }

  .spinner {
    display: inline-block;
    width: 12px;
    height: 12px;
    border: 2px solid var(--border);
    border-top-color: var(--glow);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-right: 6px;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  @media (max-width: 480px) {
    .pet-sprite { font-size: 50px; }
    #current-pet { font-size: 80px; }
    #pet-outfit { font-size: 80px; }
    .login-container { padding: 30px 20px; }
    .login-icon { font-size: 60px; }
  }
</style>
</head>
<body>

<div class="container">
  <div class="card">
    <div class="header">
      <h1>üá≤üáΩ TAMAGOTCHI AEMX</h1>
      <p class="subtitle">EDICI√ìN MEXICANA ‚Ä¢ ATLAS EARTH</p>
    </div>

  </div>
</div>

<!-- Login Screen -->
<div id="login-screen">
  <div class="login-container">
    <div class="login-icon">üá≤üáΩ</div>
    <h2 class="login-title">ACCESO RESTRINGIDO</h2>
    <p class="login-subtitle">Solo disponible en M√©xico</p>
    
    <button class="auth-btn-google" onclick="authWithGoogle()">
      <svg width="18" height="18" viewBox="0 0 18 18"><path fill="currentColor" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z"/><path fill="currentColor" d="M9.003 18c2.43 0 4.467-.806 5.956-2.18L12.05 13.56c-.806.54-1.836.86-3.047.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9.003 18z"/><path fill="currentColor" d="M3.964 10.712c-.18-.54-.282-1.117-.282-1.71 0-.593.102-1.17.282-1.71V4.96H.957C.347 6.175 0 7.55 0 9.002c0 1.452.348 2.827.957 4.042l3.007-2.332z"/><path fill="currentColor" d="M9.003 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.464.891 11.428 0 9.002 0 5.482 0 2.438 2.017.957 4.958L3.964 7.29c.708-2.127 2.692-3.71 5.036-3.71z"/></svg>
      INICIAR SESI√ìN CON GOOGLE
    </button>
    
    <div class="location-status" id="location-status"></div>
  </div>
</div>

<!-- Game Container -->
<div class="container" id="game-container" style="display:none;">
  <div class="card">
    <div class="header">
      <h1>üá≤üáΩ TAMAGOTCHI AEMX</h1>
      <p class="subtitle">EDICI√ìN MEXICANA ‚Ä¢ ATLAS EARTH</p>
    </div>

    <div class="coins-display">
      <span>üí∞</span>
      <span id="coins-amount">0</span>
      <span>AMX COINS</span>
    </div>

    <!-- Selection Screen -->
    <div id="selection-screen">
      <div class="selection-title">ELIGE TU MASCOTA</div>
      <div class="pet-options">
        <div class="pet-option" data-pet="ajolote">
          <span class="pet-sprite">ü¶é</span>
          <div class="pet-name">Ajolote</div>
        </div>
        <div class="pet-option" data-pet="quetzal">
          <span class="pet-sprite">ü¶ú</span>
          <div class="pet-name">Quetzal</div>
        </div>
        <div class="pet-option" data-pet="tlacuache">
          <span class="pet-sprite">ü¶ù</span>
          <div class="pet-name">Tlacuache</div>
        </div>
      </div>
    </div>

    <!-- Game Screen -->
    <div id="game-screen">
      <div class="pet-display">
        <div style="position: relative;">
          <div id="current-pet">ü¶é</div>
          <div id="pet-outfit">üë®‚ÄçüöÄ</div>
        </div>
      </div>

      <div class="stats">
        <div class="stat">
          <div class="stat-label">
            <span>üòä Felicidad</span>
            <span id="happiness-value">100</span>
          </div>
          <div class="stat-bar-container">
            <div class="stat-bar happiness" id="happiness-bar" style="width: 100%;"></div>
          </div>
        </div>

        <div class="stat">
          <div class="stat-label">
            <span>üçñ Hambre</span>
            <span id="hunger-value">0</span>
          </div>
          <div class="stat-bar-container">
            <div class="stat-bar hunger" id="hunger-bar" style="width: 0%;"></div>
          </div>
        </div>

        <div class="stat">
          <div class="stat-label">
            <span>üò¥ Sue√±o</span>
            <span id="sleep-value">0</span>
          </div>
          <div class="stat-bar-container">
            <div class="stat-bar sleep" id="sleep-bar" style="width: 0%;"></div>
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="btn" id="feed-btn">
          <span class="btn-icon">üçñ</span>
          <span>Alimentar</span>
        </button>
        <button class="btn" id="play-btn">
          <span class="btn-icon">üéÆ</span>
          <span>Jugar</span>
        </button>
        <button class="btn" id="sleep-btn">
          <span class="btn-icon">üò¥</span>
          <span>Dormir</span>
        </button>
      </div>

      <div class="bottom-actions">
        <button class="btn btn-secondary" id="checkin-btn">
          <span class="btn-icon">‚úÖ</span>
          <span>Check-in Diario</span>
        </button>
        <button class="btn btn-secondary" id="shop-btn">
          <span class="btn-icon">üõí</span>
          <span>Tienda</span>
        </button>
      </div>

      <button class="btn btn-reset" id="reset-btn">
        üîÑ Reiniciar Juego
      </button>
    </div>

  </div>
</div>

<!-- Shop Modal -->
<div class="modal" id="shop-modal">
  <div class="modal-content">
    <button class="modal-close" id="close-shop">√ó</button>
    <div class="modal-title">üõí TIENDA ESPACIAL</div>
    
    <div class="shop-item">
      <div class="shop-item-icon">üë®‚ÄçüöÄ</div>
      <div class="shop-item-name">Outfit Astronauta</div>
      <div class="shop-item-desc">Exclusivo para Tlacuache</div>
      <div class="shop-item-price">üí∞ 10 AMX Coins</div>
      <button class="btn-buy" id="buy-outfit-btn">Comprar</button>
    </div>
  </div>
</div>

<!-- Toast notification -->
<div class="toast" id="toast"></div>

<script type="module">
// ============================================
// FIREBASE SETUP
// ============================================
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

const firebaseConfig = {
  apiKey: "AIzaSyB-xx2PlBjvnHe0K7Bf1MspVqUlfjky0mk",
  authDomain: "aemx-chat.firebaseapp.com",
  databaseURL: "https://aemx-chat-default-rtdb.firebaseio.com",
  projectId: "aemx-chat",
  storageBucket: "aemx-chat.appspot.com",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// ============================================
// AUTHENTICATION
// ============================================
window.authWithGoogle = async function() {
  const locationStatus = document.getElementById('location-status');
  locationStatus.textContent = '';
  locationStatus.className = 'location-status';
  
  try {
    await signInWithPopup(auth, new GoogleAuthProvider());
  } catch(e) {
    locationStatus.className = 'location-status error';
    locationStatus.textContent = '‚ö†Ô∏è Error al iniciar sesi√≥n. Intenta de nuevo.';
  }
};

onAuthStateChanged(auth, (user) => {
  if (user) {
    // Usuario autenticado, verificar ubicaci√≥n
    checkLocation(user);
  } else {
    // Mostrar pantalla de login
    document.getElementById('login-screen').classList.remove('hidden');
    document.getElementById('game-container').style.display = 'none';
  }
});

// ============================================
// LOCATION VERIFICATION
// ============================================
const COUNTRY_MAP = {
  "m√©xico": "Mexico", "mexico": "Mexico",
  "estados unidos": "United States", "united states": "United States",
  "us": "United States", "usa": "United States",
};

function normalizarPais(name) {
  if (!name) return '';
  return COUNTRY_MAP[name.toLowerCase().trim()] || name;
}

async function checkLocation(user) {
  const locationStatus = document.getElementById('location-status');
  locationStatus.className = 'location-status checking';
  locationStatus.innerHTML = '<span class="spinner"></span>Verificando ubicaci√≥n...';
  
  // Intentar detectar pa√≠s por IP
  let detectedCountry = null;
  
  try {
    const res = await fetch('https://freeipapi.com/api/json');
    const data = await res.json();
    if (data.countryName) {
      detectedCountry = normalizarPais(data.countryName);
    }
  } catch(e) {
    console.log('Error con freeipapi, intentando ipapi.co');
  }
  
  if (!detectedCountry) {
    try {
      const res2 = await fetch('https://ipapi.co/json/');
      const data2 = await res2.json();
      if (data2.country_name) {
        detectedCountry = normalizarPais(data2.country_name);
      }
    } catch(e) {
      console.log('Error con ipapi.co');
    }
  }
  
  // Verificar si es M√©xico
  if (detectedCountry === 'Mexico') {
    locationStatus.className = 'location-status success';
    locationStatus.textContent = '‚úÖ Ubicaci√≥n verificada: M√©xico';
    
    setTimeout(() => {
      grantAccess(user);
    }, 1000);
  } else {
    locationStatus.className = 'location-status error';
    locationStatus.textContent = `‚ö†Ô∏è Solo disponible en M√©xico${detectedCountry ? ' (Detectado: ' + detectedCountry + ')' : ''}`;
    
    showToast('Acceso denegado: Solo disponible en M√©xico', 'warning');
  }
}

function grantAccess(user) {
  // Ocultar login
  document.getElementById('login-screen').classList.add('hidden');
  document.getElementById('game-container').style.display = 'block';
  
  // Cargar estado del juego
  loadState();
  
  // Mostrar pantalla apropiada
  if (gameState.selectedPet) {
    document.getElementById('selection-screen').style.display = 'none';
    document.getElementById('game-screen').style.display = 'block';
    updateUI();
    startDegradationTimer();
  } else {
    document.getElementById('selection-screen').style.display = 'block';
    document.getElementById('game-screen').style.display = 'none';
  }
  
  showToast(`¬°Bienvenido ${user.displayName || user.email}!`, 'success');
}

// ============================================
// GAME STATE
// ============================================
const gameState = {
  selectedPet: null,
  happiness: 100,
  hunger: 0,
  sleep: 0,
  coins: 0,
  lastCheckin: null,
  hasOutfit: false,
  petSprites: {
    ajolote: 'ü¶é',
    quetzal: 'ü¶ú',
    tlacuache: 'ü¶ù'
  }
};

// Load saved state
function loadState() {
  const saved = localStorage.getItem('tamagotchiAEMX');
  if (saved) {
    const data = JSON.parse(saved);
    Object.assign(gameState, data);
    return true;
  }
  return false;
}

// Save state
function saveState() {
  localStorage.setItem('tamagotchiAEMX', JSON.stringify(gameState));
}

// Show toast notification
function showToast(message, type = 'success') {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.className = `toast ${type}`;
  toast.classList.add('show');
  
  setTimeout(() => {
    toast.classList.remove('show');
  }, 3000);
}

// Update UI
function updateUI() {
  // Update coins
  document.getElementById('coins-amount').textContent = gameState.coins;
  
  // Update stats
  document.getElementById('happiness-value').textContent = gameState.happiness;
  document.getElementById('hunger-value').textContent = gameState.hunger;
  document.getElementById('sleep-value').textContent = gameState.sleep;
  
  document.getElementById('happiness-bar').style.width = gameState.happiness + '%';
  document.getElementById('hunger-bar').style.width = gameState.hunger + '%';
  document.getElementById('sleep-bar').style.width = gameState.sleep + '%';
  
  // Update pet sprite
  const petElement = document.getElementById('current-pet');
  petElement.textContent = gameState.petSprites[gameState.selectedPet];
  
  // Update outfit
  const outfitElement = document.getElementById('pet-outfit');
  if (gameState.hasOutfit && gameState.selectedPet === 'tlacuache') {
    outfitElement.classList.add('visible');
  } else {
    outfitElement.classList.remove('visible');
  }
  
  // Apply animations based on state
  petElement.classList.remove('hungry', 'happy', 'sad');
  
  if (gameState.hunger > 70) {
    petElement.classList.add('hungry');
  }
  if (gameState.happiness > 80) {
    petElement.classList.add('happy');
  }
  if (gameState.happiness < 30) {
    petElement.classList.add('sad');
  }
  
  saveState();
}

// Degrade stats
let degradationTimer = null;

function degradeStats() {
  gameState.hunger = Math.min(100, gameState.hunger + 2);
  gameState.sleep = Math.min(100, gameState.sleep + 1);
  gameState.happiness = Math.max(0, gameState.happiness - 1);
  
  updateUI();
}

function startDegradationTimer() {
  if (degradationTimer) return;
  degradationTimer = setInterval(degradeStats, 60000);
}

// Action: Feed
function feed() {
  gameState.hunger = Math.max(0, gameState.hunger - 20);
  gameState.happiness = Math.min(100, gameState.happiness + 5);
  showToast('üçñ ¬°√ëam √±am! Tu mascota est√° feliz', 'success');
  updateUI();
}

// Action: Play
function play() {
  gameState.happiness = Math.min(100, gameState.happiness + 15);
  gameState.hunger = Math.min(100, gameState.hunger + 5);
  gameState.sleep = Math.min(100, gameState.sleep + 5);
  showToast('üéÆ ¬°Diversi√≥n espacial!', 'success');
  updateUI();
}

// Action: Sleep
function sleep() {
  gameState.sleep = Math.max(0, gameState.sleep - 30);
  gameState.happiness = Math.min(100, gameState.happiness + 10);
  showToast('üò¥ Zzz... Tu mascota descans√≥ bien', 'success');
  updateUI();
}

// Daily check-in
function checkIn() {
  const today = new Date().toDateString();
  
  if (gameState.lastCheckin === today) {
    showToast('‚ö†Ô∏è Ya hiciste check-in hoy', 'warning');
    return;
  }
  
  gameState.coins += 1;
  gameState.lastCheckin = today;
  showToast('üí∞ +1 AMX Coin obtenido!', 'gold');
  updateUI();
}

// Buy outfit
function buyOutfit() {
  if (gameState.selectedPet !== 'tlacuache') {
    showToast('‚ö†Ô∏è Solo para Tlacuache', 'warning');
    return;
  }
  
  if (gameState.hasOutfit) {
    showToast('‚ö†Ô∏è Ya tienes este outfit', 'warning');
    return;
  }
  
  if (gameState.coins < 10) {
    showToast('‚ö†Ô∏è Necesitas 10 coins', 'warning');
    return;
  }
  
  gameState.coins -= 10;
  gameState.hasOutfit = true;
  showToast('üë®‚ÄçüöÄ ¬°Outfit comprado!', 'gold');
  updateUI();
  closeShop();
}

// Open/close shop
function openShop() {
  document.getElementById('shop-modal').classList.add('active');
}

function closeShop() {
  document.getElementById('shop-modal').classList.remove('active');
}

// Reset game
function resetGame() {
  if (confirm('¬øSeguro que quieres reiniciar? Se perder√° todo el progreso.')) {
    localStorage.removeItem('tamagotchiAEMX');
    location.reload();
  }
}

// Pet selection
document.querySelectorAll('.pet-option').forEach(option => {
  option.addEventListener('click', function() {
    const pet = this.dataset.pet;
    gameState.selectedPet = pet;
    
    document.getElementById('selection-screen').style.display = 'none';
    document.getElementById('game-screen').style.display = 'block';
    
    updateUI();
    showToast(`üéâ ¬°${pet.charAt(0).toUpperCase() + pet.slice(1)} seleccionado!`, 'success');
    
    startDegradationTimer();
  });
});

// Event listeners
document.getElementById('feed-btn').addEventListener('click', feed);
document.getElementById('play-btn').addEventListener('click', play);
document.getElementById('sleep-btn').addEventListener('click', sleep);
document.getElementById('checkin-btn').addEventListener('click', checkIn);
document.getElementById('shop-btn').addEventListener('click', openShop);
document.getElementById('close-shop').addEventListener('click', closeShop);
document.getElementById('buy-outfit-btn').addEventListener('click', buyOutfit);
document.getElementById('reset-btn').addEventListener('click', resetGame);

// Close modal on outside click
document.getElementById('shop-modal').addEventListener('click', function(e) {
  if (e.target === this) closeShop();
});
</script>

</body>
</html>